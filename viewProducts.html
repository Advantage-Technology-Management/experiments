<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Images for Given LOBs and LIAMs</title>
    <style>
        .product {
            margin-bottom: 10px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }

        .image-container {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }

        .image-container img {
            margin-right: 10px;
            max-width: 200px;
            max-height: 200px;
        }

        .image-info {
            display: flex;
            flex-direction: column;
        }
    </style>
</head>

<body>

    <h2>Display Images for Given LOBs and LIAM 3</h2>

    <div class="env">
        <label for="env">Environment</label>
        <select name="env" id="env">
        <option value="dev1">dev1</option>
        <option value="stage">stage</option>
        </select>
    </div>
    <input type="text" id="queryInput" placeholder="eg: jf/21371964_ea, abc/12345_xyz">
    <button onclick="performQuery()">Submit</button>

    <div id="response"></div>
    <div id="products"></div>


    <script>

        async function performQuery() {
            var inputValues = document.getElementById("queryInput").value.split(',');
            var productsDiv = document.getElementById("products");
            productsDiv.innerHTML = ''; // Clear previous results
            
            for (let inputValue of inputValues) {
                await fetchData(inputValue.trim());
            }
        }
    

        async function fetchData(inputValue) {
            var url = "https://dis-" + document.getElementById('env').value + ".assetful.loblaw.ca/products/" + inputValue + "/.addonjson";
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Cache-Control': 'no-cache',
                        'Accept': 'application/json;charset=utf-8'
                    },
                    mode: "cors"
                });
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const ndjson = await response.text();
                const jsonData = ndjson.split('\n').map(line => JSON.parse(line));
                displayData(jsonData, inputValue);
            } catch (error) {
                console.error('Error:', error);
            }
        }

// Function to display JSON data with images and image angles
function displayData(jsonData, inputValue) {
    var productsDiv = document.getElementById("products");

    var queryContainer = document.createElement("div");
    queryContainer.innerHTML = "<h3>Query Input: " + inputValue + "</h3>";
    productsDiv.appendChild(queryContainer);

    jsonData.forEach(function (product) {
        var productDiv = document.createElement("div");
        productDiv.classList.add("product");

        var productInfo = document.createElement("p");
        productInfo.innerHTML = "<strong>LOB:</strong> " + product.product_type + "<br>" +
            "<strong>LIAM:</strong> " + product.liam + "<br>";
        productDiv.appendChild(productInfo);

        var articleIDsInfo = document.createElement("p");
        articleIDsInfo.textContent = "ArticleIDs: " + product.actualArticleIDs;
        productDiv.appendChild(articleIDsInfo);

        var scancodesInfo = document.createElement("p");
        scancodesInfo.textContent = "Scancodes: " + product.actualScancodes;
        productDiv.appendChild(scancodesInfo);

        var gTINsInfo = document.createElement("p");
        gTINsInfo.textContent = "GTINS: " + product.actualGTINs;
        productDiv.appendChild(gTINsInfo);

        var productStatusInfo = document.createElement("p");
        productStatusInfo.textContent = "Product Status: " + product.actualProductStatus;
        productDiv.appendChild(productStatusInfo);



//sdm/3980009909


        // Sort image angles by presentationOrder
        product.image_angles.sort((a, b) => a.presentation_order - b.presentation_order);

        product.image_angles.forEach(function (image) {
            var imageContainer = document.createElement("div");
            imageContainer.classList.add("image-container");

            var img = document.createElement("img");
            img.src = image.url + "?width=240";
            img.alt = image.url;
            imageContainer.appendChild(img);

            var imageInfo = document.createElement("div");
            imageContainer.classList.add("image-info");

            var articleIDsInfo = document.createElement("p");
            articleIDsInfo.textContent = "ArticleIDs: " + product.actualArticleIDs;
            productDiv.appendChild(articleIDsInfo);
    
            var scancodesInfo = document.createElement("p");
            scancodesInfo.textContent = "Scancodes: " + product.actualScancodes;
            productDiv.appendChild(scancodesInfo);
    
            var gTINsInfo = document.createElement("p");
            gTINsInfo.textContent = "GTINS: " + product.actualGTINs;
            productDiv.appendChild(gTINsInfo);
    
            var productStatusInfo = document.createElement("p");
            productStatusInfo.textContent = "Product Status: " + product.actualProductStatus;
            productDiv.appendChild(productStatusInfo);


            var imageFormatInfo = document.createElement("p");
            imageFormatInfo.textContent = "Format: " + image.actualImageFormat;
            imageContainer.appendChild(imageFormatInfo);

            var actualImageFacingInfo = document.createElement("p");
            actualImageFacingInfo.textContent = "Facing: " + image.actualImageFacing;
            imageContainer.appendChild(actualImageFacingInfo);

            var actuallanguageInfo = document.createElement("p");
            actuallanguageInfo.textContent = "Actual Language: " + image.actuaLanguage;
            imageContainer.appendChild(actuallanguageInfo);

            var languageInfo = document.createElement("p");
            languageInfo.textContent = "Language: " + image.language;
            imageContainer.appendChild(languageInfo);

            var presentationOrderInfo = document.createElement("p");
            presentationOrderInfo.textContent = "Presentation Order: " + image.presentation_order;
            imageContainer.appendChild(presentationOrderInfo);

            var isPrimaryInfo = document.createElement("p");
            isPrimaryInfo.textContent = "Is Primary: " + image.is_primary;
            imageContainer.appendChild(isPrimaryInfo);

            var presentationTypeInfo = document.createElement("p");
            presentationTypeInfo.textContent = "Presentation Type: " + image.presentation_type;
            imageContainer.appendChild(presentationTypeInfo);

            var angleInfo = document.createElement("p");
            angleInfo.textContent = "Angle: " + image.angle;
            imageContainer.appendChild(angleInfo);

            var URLInfo = document.createElement("p");
            URLInfo.textContent = "Pristine URL: " + image.url;
            imageContainer.appendChild(URLInfo);

            imageContainer.appendChild(imageInfo);
            productDiv.appendChild(imageContainer);
        });

        queryContainer.appendChild(productDiv);
    });
}


    </script>

</body>

</html>
