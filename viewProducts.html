<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Images for Given LOBs and LIAMs</title>
    <style>
        .product {
            margin-bottom: 10px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }

        .image-container {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }

        .image-container img {
            margin-right: 10px;
            max-width: 300px;
            max-height: 300px;
        }

        .image-info {
            display: flex;
            flex-direction: column;
        }
    </style>
</head>

<body>

    <h2>Display Images for Given LOBs and LIAM</h2>

    <div class="env">
        <label for="env">Environment</label>
        <select name="env" id="env">
        <option value="dev1">dev1</option>
        <option value="stage">stage</option>
        </select>
    </div>
    <input type="text" id="queryInput" placeholder="eg: jf/21371964_ea, abc/12345_xyz">
    <button onclick="performQuery()">Submit</button>

    <div id="response"></div>
    <div id="products"></div>


    <script>

        async function performQuery() {
            var inputValues = document.getElementById("queryInput").value.split(',');
            var productsDiv = document.getElementById("products");
            productsDiv.innerHTML = ''; // Clear previous results
            
            for (let inputValue of inputValues) {
                await fetchData(inputValue.trim());
            }
        }
    

        async function fetchData(inputValue) {
            var url = "https://dis-" + document.getElementById('env').value + ".assetful.loblaw.ca/products/" + inputValue + "/.json";
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Cache-Control': 'no-cache',
                        'Accept': 'application/json;charset=utf-8'
                    },
                    mode: "cors"
                });
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const ndjson = await response.text();
                const jsonData = ndjson.split('\n').map(line => JSON.parse(line));
                displayData(jsonData, inputValue);
            } catch (error) {
                console.error('Error:', error);
            }
        }

// Function to display JSON data with images and image angles
function displayData(jsonData, inputValue) {
    var productsDiv = document.getElementById("products");

    var queryContainer = document.createElement("div");
    queryContainer.innerHTML = "<h3>Query Input: " + inputValue + "</h3>";
    productsDiv.appendChild(queryContainer);

    jsonData.forEach(function (product) {
        var productDiv = document.createElement("div");
        productDiv.classList.add("product");

        var productInfo = document.createElement("p");
        productInfo.innerHTML = "<strong>LOB:</strong> " + product.product_type + "<br>" +
            "<strong>LIAM:</strong> " + product.liam + "<br>";
        productDiv.appendChild(productInfo);

        // Sort image angles by presentationOrder
        product.image_angles.sort((a, b) => a.presentationOrder - b.presentationOrder);

        product.image_angles.forEach(function (image) {
            var imageContainer = document.createElement("div");
            imageContainer.classList.add("image-container");

            var img = document.createElement("img");
            img.src = image.url + "?width=200";
            img.alt = image.url;
            imageContainer.appendChild(img);

            var imageInfo = document.createElement("div");
            imageContainer.classList.add("image-info");

            var languageInfo = document.createElement("p");
            languageInfo.textContent = "Language: " + image.language;
            imageContainer.appendChild(languageInfo);

            var presentationOrderInfo = document.createElement("p");
            presentationOrderInfo.textContent = "Presentation Order: " + image.presentationOrder;
            imageContainer.appendChild(presentationOrderInfo);

            var presentationTypeInfo = document.createElement("p");
            presentationTypeInfo.textContent = "Presentation Type: " + image.presentation_type;
            imageContainer.appendChild(presentationTypeInfo);

            var angleInfo = document.createElement("p");
            angleInfo.textContent = "Angle: " + image.angle;
            imageContainer.appendChild(angleInfo);

            var URLInfo = document.createElement("p");
            URLInfo.textContent = "Pristine URL: " + image.url;
            imageContainer.appendChild(URLInfo);

            imageContainer.appendChild(imageInfo);
            productDiv.appendChild(imageContainer);
        });

        queryContainer.appendChild(productDiv);
    });
}


    </script>

</body>

</html>
